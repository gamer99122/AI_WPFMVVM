<Window x:Class="MS01_BasicConnection.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:MS01_BasicConnection.ViewModels"
        Title="MS01 - MSSQL 基本連線"
        Height="600"
        Width="900"
        WindowStartupLocation="CenterScreen">

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 連線資訊區 -->
        <GroupBox Grid.Row="0"
                  Header="資料庫連線資訊"
                  Padding="10"
                  Margin="0,0,0,10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="120"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- 連線狀態 -->
                <TextBlock Grid.Row="0"
                           Grid.Column="0"
                           Text="連線狀態："
                           VerticalAlignment="Center"
                           Margin="0,5"/>
                <TextBlock Grid.Row="0"
                           Grid.Column="1"
                           Text="{Binding ConnectionStatus}"
                           VerticalAlignment="Center"
                           FontWeight="Bold"
                           Margin="0,5"/>

                <!-- 伺服器版本 -->
                <TextBlock Grid.Row="1"
                           Grid.Column="0"
                           Text="伺服器版本："
                           VerticalAlignment="Center"
                           Margin="0,5"/>
                <TextBlock Grid.Row="1"
                           Grid.Column="1"
                           Text="{Binding ServerVersion}"
                           VerticalAlignment="Center"
                           Margin="0,5"/>

                <!-- 客戶數量 -->
                <TextBlock Grid.Row="2"
                           Grid.Column="0"
                           Text="客戶總數："
                           VerticalAlignment="Center"
                           Margin="0,5"/>
                <TextBlock Grid.Row="2"
                           Grid.Column="1"
                           VerticalAlignment="Center"
                           Margin="0,5">
                    <Run Text="{Binding CustomerCount, Mode=OneWay}"/>
                    <Run Text=" 筆"/>
                </TextBlock>
            </Grid>
        </GroupBox>

        <!-- 操作按鈕區 -->
        <GroupBox Grid.Row="1"
                  Header="操作"
                  Padding="10"
                  Margin="0,0,0,10">
            <UniformGrid Rows="1"
                         Columns="3">
                <Button Content="1️⃣ 初始化資料庫"
                        Command="{Binding InitializeDatabaseCommand}"
                        Margin="0,0,5,0"
                        Padding="10,8"
                        FontSize="14"
                        Background="#3498DB"
                        Foreground="White"
                        BorderThickness="0"
                        ToolTip="建立資料表並插入範例資料"/>

                <Button Content="2️⃣ 測試連線"
                        Command="{Binding TestConnectionCommand}"
                        Margin="5,0"
                        Padding="10,8"
                        FontSize="14"
                        Background="#27AE60"
                        Foreground="White"
                        BorderThickness="0"
                        ToolTip="測試資料庫連線是否正常"/>

                <Button Content="3️⃣ 載入客戶資料"
                        Command="{Binding LoadCustomersCommand}"
                        Margin="5,0,0,0"
                        Padding="10,8"
                        FontSize="14"
                        Background="#E67E22"
                        Foreground="White"
                        BorderThickness="0"
                        ToolTip="從資料庫載入所有客戶資料"/>
            </UniformGrid>
        </GroupBox>

        <!-- 資料顯示區 -->
        <GroupBox Grid.Row="2"
                  Header="客戶列表"
                  Padding="10">
            <Grid>
                <!-- 載入中提示 -->
                <TextBlock Text="載入中..."
                           FontSize="16"
                           Foreground="Gray"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}"/>

                <!-- 資料列表 -->
                <DataGrid ItemsSource="{Binding Customers}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          SelectionMode="Single"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          GridLinesVisibility="Horizontal"
                          HeadersVisibility="Column"
                          AlternatingRowBackground="#F5F5F5">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID"
                                            Binding="{Binding Id}"
                                            Width="60"/>
                        <DataGridTextColumn Header="姓名"
                                            Binding="{Binding Name}"
                                            Width="*"/>
                        <DataGridTextColumn Header="Email"
                                            Binding="{Binding Email}"
                                            Width="*"/>
                        <DataGridTextColumn Header="電話"
                                            Binding="{Binding Phone}"
                                            Width="120"/>
                        <DataGridTextColumn Header="城市"
                                            Binding="{Binding City}"
                                            Width="100"/>
                        <DataGridTextColumn Header="建立時間"
                                            Binding="{Binding CreatedAt, StringFormat='yyyy-MM-dd HH:mm'}"
                                            Width="150"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </GroupBox>

        <!-- 說明訊息 -->
        <Border Grid.Row="2"
                Background="#FFF3CD"
                BorderBrush="#FFC107"
                BorderThickness="1"
                Padding="10"
                Margin="10"
                VerticalAlignment="Top"
                Visibility="{Binding Customers.Count, Converter={StaticResource ZeroToVisibilityConverter}}">
            <StackPanel>
                <TextBlock FontWeight="Bold"
                           Foreground="#856404"
                           Margin="0,0,0,5">
                    📌 使用說明：
                </TextBlock>
                <TextBlock TextWrapping="Wrap"
                           Foreground="#856404">
                    1. 首次使用請先點擊「初始化資料庫」按鈕建立資料表
                    <LineBreak/>
                    2. 點擊「測試連線」確認資料庫連線正常
                    <LineBreak/>
                    3. 點擊「載入客戶資料」查看資料庫內容
                </TextBlock>
            </StackPanel>
        </Border>
    </Grid>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
    </Window.Resources>
</Window>
